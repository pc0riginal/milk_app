{% extends "base.html" %}

{% block content %}
{% if message %}
<div class="alert alert-success">{{ message }}</div>
{% endif %}

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

<div class="card">
    <h2>Update Default Milk Rate</h2>
    <form method="POST" action="/settings">
        <div class="form-group">
            <label for="milk_rate">Default Rate per Liter (₹)</label>
            <input type="number" step="0.01" class="form-control" id="milk_rate" name="milk_rate" value="{{ milk_rate }}" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Rate</button>
    </form>
</div>

<div class="card">
    <h2>Add New Purchase</h2>
    <form method="POST">
        <div class="form-group">
            <label for="person">Select Person</label>
            <select class="form-control" id="person" name="person" required>
                <option value="">Choose a person...</option>
                {% for person in people %}
                <option value="{{ person.name }}">{{ person.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="date">Date (Optional)</label>
            <input type="date" class="form-control" id="date" name="date">
            <small style="color: #6c757d;">Leave empty for today's date</small>
        </div>
        
        <div class="form-group">
            <label for="quantity">Quantity (Liters)</label>
            <input type="number" step="0.1" class="form-control" id="quantity" name="quantity" required>
        </div>
        
        <div class="form-group">
            <label for="price_per_liter">Price per Liter (₹) - Optional</label>
            <input type="number" step="0.01" class="form-control" id="price_per_liter" name="price_per_liter" placeholder="Default: ₹{{ milk_rate }}">
            <small style="color: #6c757d;">Leave empty to use default rate of ₹{{ milk_rate }}</small>
        </div>
        
        {% if people %}
        <button type="submit" class="btn btn-primary">Add Purchase</button>
        {% else %}
        <p style="color: #6c757d;">No people added yet. <a href="/people">Add people first</a></p>
        {% endif %}
    </form>
</div>

<div class="card">
    <h3>Quick Calculation</h3>
    <div id="calculation" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Total Cost:</span>
            <span id="total-cost">₹0.00</span>
        </div>
    </div>
</div>

<script>
function updateCalculation() {
    const quantity = parseFloat(document.getElementById('quantity').value) || 0;
    const pricePerLiter = parseFloat(document.getElementById('price_per_liter').value) || {{ milk_rate }};
    
    const totalCost = quantity * pricePerLiter;
    
    document.getElementById('total-cost').textContent = `₹${totalCost.toFixed(2)}`;
}

document.getElementById('quantity').addEventListener('input', updateCalculation);
document.getElementById('price_per_liter').addEventListener('input', updateCalculation);
</script>
{% endblock %}